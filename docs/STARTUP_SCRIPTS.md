# 启动脚本说明

## 可用脚本

### 1. start-dev.cmd - 开发环境启动
**用途**：启动开发环境，前后端分离运行

**功能**：
- 自动检测并停止占用端口的进程
- 启动后端服务（端口 5678）
- 启动前端开发服务器（端口 3012，支持热重载）
- 打开两个独立的命令行窗口

**访问地址**：
- 前端：http://localhost:3012
- 后端 API：http://localhost:5678/api/v1

**使用场景**：
- 前端开发调试
- 需要热重载功能
- 前后端分离开发

---

### 2. start-prod.cmd - 生产环境启动
**用途**：构建并启动生产环境

**功能**：
- 自动检测并停止占用端口的进程
- 构建前端静态文件（npm run build）
- 启动后端服务，同时提供 API 和前端静态文件
- 只需一个端口（5678）

**访问地址**：
- 应用首页：http://localhost:5678
- 后端 API：http://localhost:5678/api/v1

**使用场景**：
- 生产环境部署
- 测试完整构建
- 单端口访问

---

### 3. stop-dev.cmd - 停止所有服务
**用途**：停止所有开发和生产服务

**功能**：
- 停止端口 5678 上的后端服务
- 停止端口 3012 上的前端开发服务器
- 自动清理进程

**使用场景**：
- 需要完全停止所有服务
- 切换开发/生产环境前
- 端口被占用需要释放

---

## 使用方法

### 开发环境
```cmd
# 启动开发环境
双击 start-dev.cmd

# 或在命令行中运行
start-dev.cmd
```

### 生产环境
```cmd
# 启动生产环境
双击 start-prod.cmd

# 或在命令行中运行
start-prod.cmd
```

### 停止服务
```cmd
# 停止所有服务
双击 stop-dev.cmd

# 或在命令行中运行
stop-dev.cmd

# 或直接关闭服务窗口
```

---

## 注意事项

1. **首次运行**：
   - 确保已安装 Go 和 Node.js
   - 确保已运行 `npm install` 安装前端依赖
   - 确保配置文件 `configs/config.yaml` 已创建

2. **端口占用**：
   - 脚本会自动检测并停止占用端口的进程
   - 如果手动停止失败，可以使用 stop-dev.cmd

3. **Go 代理**：
   - 脚本已配置国内 Go 代理（goproxy.cn）
   - 如需修改，编辑脚本中的 `GOPROXY` 变量

4. **窗口管理**：
   - 每个服务在独立窗口运行
   - 关闭窗口即停止对应服务
   - 启动脚本窗口可以关闭，不影响服务运行

5. **日志查看**：
   - 后端日志：查看后端服务窗口
   - 前端日志：查看前端服务窗口
   - 构建日志：查看启动脚本窗口

---

## 故障排除

### 问题：端口被占用
**解决方案**：
1. 运行 `stop-dev.cmd` 停止所有服务
2. 或手动查找并停止进程：
   ```cmd
   netstat -ano | findstr :5678
   taskkill /F /PID <进程ID>
   ```

### 问题：前端构建失败
**解决方案**：
1. 检查 Node.js 版本（建议 16+）
2. 重新安装依赖：
   ```cmd
   cd web
   npm install
   ```

### 问题：后端启动失败
**解决方案**：
1. 检查 Go 版本（建议 1.19+）
2. 检查配置文件是否存在：`configs/config.yaml`
3. 查看后端服务窗口的错误信息

### 问题：无法访问服务
**解决方案**：
1. 检查防火墙设置
2. 确认服务已启动（查看服务窗口）
3. 尝试使用 `http://127.0.0.1` 代替 `localhost`

---

## 高级配置

### 修改端口
编辑对应脚本，修改端口检测部分：
```cmd
REM 修改后端端口（默认 5678）
findstr :5678

REM 修改前端端口（默认 3012）
findstr :3012
```

同时需要修改：
- 后端配置：`configs/config.yaml` 中的 `server.port`
- 前端配置：`web/vite.config.ts` 中的 `server.port`

### 添加环境变量
在脚本中添加：
```cmd
set MY_VAR=value
```

---

## 相关文档

- [ComfyUI 集成指南](COMFYUI_WORKFLOW_GUIDE.md)
- [ComfyUI 快速开始](docs/COMFYUI_QUICKSTART.md)
- [API 文档](docs/API.md)
